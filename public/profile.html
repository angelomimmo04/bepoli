<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="style-profilo.css" rel="stylesheet">  <!--serve per collegare lo stile alla pagina e poi la relazione-->

    <title>profilo utente</title>
</head>
<body>
<script>

    window.onload = function () { //fa caricare prima la pagina e poi esegue questo
        // Recupera l'utente dal sessionStorage
        const user = JSON.parse(sessionStorage.getItem("user"));


        if (user) {
            document.title = user.username + "'s profile";
            document.getElementById("name").textContent = user.nome;
            document.getElementById("username").textContent = user.username;
        } else {
            //alert("Devi prima effettuare il login.");
            //window.location.href = "login.html";
        }
    };


</script>





<header>
  <a href="prova18.html">
    <img src="logobepoli.png" alt="Logo" id="logo">
  </a>
</header>


<nav class="leftnav" id="mainnav">
  <ul>  <!-- ul sta per unordered list-->
    <li> <a href="prova18.html">home</a> </li>  <!-- creo un elemento della lista con attributo che Ã¨ a cosa punta il link e poi il nome che viene visualizzato-->
    <li> <a href="">messaggi</a></li>
    <li> <a href="">notifiche</a></li>
    <li> <a href="">esplora</a></li>
    <li> <a href="profile.html">profilo</a></li>
    <li> <a href=>crea</a></li>


  </ul>

</nav>

<div id="info">
    <div id="base">



        <img src="fotoprofilo.png" alt="Profilo utente" id="profile">
        <div id="gigi">
            <p id="username">loading...</p>


            <div id="social">
                <div>

                    <p>post</p>
                </div>
                <div>

                    <p>follower</p>
                </div>
                <div>

                    <p>seguiti</p>
                </div>

                <button id="editBtn">Modifica profilo</button>

                <div id="editForm" style="display: none;">
                    <label>Nuova bio:</label><br>
                    <textarea id="bioInput"></textarea><br>

                    <label>Nuova immagine profilo (URL):</label><br>
                    <input type="text" id="profilePicInput"><br>

                    <button id="saveBtn">Salva</button>
                </div>

            </div>
            <h1 id="name">nome utente</h1>


            <p id="bio">Bio utente</p>


        </div>


    </div>


</div>



<script>
    document.getElementById("editBtn").addEventListener("click", () => {
        document.getElementById("editForm").style.display = "block";
    });

    document.getElementById("saveBtn").addEventListener("click", async () => {
        const newBio = document.getElementById("bioInput").value;
        const newProfilePic = document.getElementById("profilePicInput").value;

        const user = JSON.parse(sessionStorage.getItem("user"));
        if (!user) return alert("Utente non trovato!");

        const response = await fetch("/api/update-profile", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                userId: user._id,
                newBio: newBio,
                newProfilePic: newProfilePic
            })
        });

        if (response.ok) {
            document.getElementById("bio").textContent = newBio;
            document.getElementById("profile").src = newProfilePic;
            document.getElementById("editForm").style.display = "none";
        } else {
            alert("Errore durante il salvataggio.");
        }
    });
</script>


</body>
</html>
